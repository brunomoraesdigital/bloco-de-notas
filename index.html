<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bloco de Notas</title>
  <style>
    :root {
      --fundo: #fffefd;
      --accent: #f2f2f2;
      --borda: #dedede;
      --texto: #333333;
      --destaque: #1f6feb;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(180deg, #f6f8fa, #f0f3f6);
      padding: 20px;
      color: var(--texto);
      line-height: 1.6;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: var(--fundo);
      border: 1px solid var(--borda);
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(12, 18, 31, 0.1);
      overflow: hidden;
    }
    
    header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--accent);
      border-bottom: 1px solid var(--borda);
      transition: background 0.3s;
    }
    
    .titulo-container {
      display: flex;
      flex-direction: column;
    }
    
    h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 600;
    }
    
    .botoes {
      display: flex;
      gap: 8px;
    }
    
    .botao {
      background: #ffffff;
      border: 1px solid var(--borda);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .botao:hover {
      background: #f9f9f9;
      transform: translateY(-1px);
    }
    
    .botao.ativo {
      background: #eef9d8;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    }
    
    .area {
      display: flex;
      gap: 12px;
      padding: 16px;
      transition: background 0.3s;
    }
    
    .barra-lateral {
      width: 220px;
      border-right: 1px dashed var(--borda);
      padding-right: 12px;
    }
    
    .info {
      font-size: 13px;
      color: #555;
    }
    
    .info p {
      margin-bottom: 8px;
    }
    
    .editor {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    /* Container das abas com scroll horizontal */
    .abas-container {
      position: relative;
      border-bottom: 1px solid var(--borda);
      background: #fafafa;
    }
    
    .abas {
      display: flex;
      gap: 6px;
      padding: 6px;
      overflow-x: auto;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge */
    }
    
    .abas::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
    
    /* Indicador de mais conteúdo (setas) */
    .scroll-indicator {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg, rgba(250,250,250,0.9) 0%, rgba(250,250,250,0.5) 100%);
      z-index: 1;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      cursor: pointer;
    }
    
    .scroll-indicator.left {
      left: 0;
      background: linear-gradient(90deg, rgba(250,250,250,0.9) 0%, rgba(250,250,250,0.5) 100%);
    }
    
    .scroll-indicator.right {
      right: 0;
      background: linear-gradient(270deg, rgba(250,250,250,0.9) 0%, rgba(250,250,250,0.5) 100%);
    }
    
    .abas-container:hover .scroll-indicator {
      opacity: 1;
    }
    
    .aba {
      padding: 8px 12px;
      border: 1px solid var(--borda);
      border-radius: 8px 8px 0 0;
      background: #eaeaea;
      cursor: pointer;
      font-size: 14px;
      outline: none;
      white-space: nowrap;
      flex-shrink: 0;
      transition: all 0.2s;
      position: relative;
      min-width: 80px;
      text-align: center;
    }
    
    .aba:hover {
      background: #e0e0e0;
    }
    
    .aba.ativa {
      background: white;
      border-bottom: 1px solid white;
      font-weight: 600;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.05);
    }
    
    .aba[contenteditable="true"] {
      min-width: 80px;
    }
    
    /* Cores das abas */
    .aba[data-id="1"] { background: #fff; }
    .aba[data-id="2"] { background: #ffd6d6; }
    .aba[data-id="3"] { background: #ffe5b4; }
    .aba[data-id="4"] { background: #fffacd; }
    .aba[data-id="5"] { background: #d9fdd3; }
    .aba[data-id="6"] { background: #d6eaff; }
    .aba[data-id="7"] { background: #dcd6ff; }
    .aba[data-id="8"] { background: #f0d6ff; }
    
    .aba.ativa[data-id="1"] { background: #fff; }
    .aba.ativa[data-id="2"] { background: #ffc8c8; }
    .aba.ativa[data-id="3"] { background: #ffdd9e; }
    .aba.ativa[data-id="4"] { background: #fff6b3; }
    .aba.ativa[data-id="5"] { background: #c5fcbd; }
    .aba.ativa[data-id="6"] { background: #c0e2ff; }
    .aba.ativa[data-id="7"] { background: #d0c8ff; }
    .aba.ativa[data-id="8"] { background: #e6c2ff; }

    .conteudo {
      height: 400px;
      padding: 16px;
      border: 1px solid var(--borda);
      border-radius: 8px;
      background: white;
      outline: none;
      overflow-y: auto;
      line-height: 1.5;
      font-family: inherit;
      font-size: 15px;
      white-space: pre-wrap;
      margin-bottom: 12px;
    }
    
    .conteudo.vazio {
      color: #aaa;
      font-style: italic;
    }
    
    .rodape {
      padding: 10px 12px;
      border-top: 1px solid var(--borda);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #555;
      transition: background 0.3s;
    }
    
    .btn-acao {
      background: var(--destaque);
      color: white;
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-acao:hover {
      background: #0e5fc5;
      transform: translateY(-1px);
    }
    
    .copyright {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }
    
    .copyright a {
      text-decoration: none;
      color: #666;
      transition: color 0.2s;
      white-space: nowrap;
    }
    
    .copyright a:hover {
      color: var(--destaque);
    }
    
    #status {
      font-size: 12px;
      color: #666;
    }
    
    /* Responsividade */
    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .botoes {
        width: 100%;
        justify-content: flex-end;
      }
      
      .barra-lateral {
        display: none;
      }
      
      .area {
        padding: 12px;
      }
      
      .conteudo {
        height: 300px;
        font-size: 16px; /* Melhor leitura em mobile */
      }
      
      .aba {
        padding: 6px 10px;
        font-size: 13px;
        min-width: 70px;
      }
      
      .copyright {
        flex-direction: column;
        align-items: flex-end;
        gap: 4px;
      }
	  .comoArmazena {
	  font-size: 12px;
    }
    
    @media (max-width: 480px) {
      .botoes {
        flex-wrap: wrap;
        gap: 6px;
      }
      
      .botao {
        flex: 1;
        min-width: calc(50% - 6px);
        padding: 8px;
      }
      
      .abas {
        padding: 4px;
      }
      
      .aba {
        min-width: 60px;
        font-size: 12px;
        padding: 6px 8px;
      }
      
      .conteudo {
        height: 250px;
        padding: 12px;
      }  
	  
      .rodape {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
      }
      
      .copyright {
        align-items: center;
        justify-content: center;
        text-align: center;
      }
	  
    }
    

  </style>
</head>
<body>
  <div class="container" role="application">
    <header id="header">
      <div class="titulo-container">
        <h1>Bloco de Notas</h1>
      </div>
      <div class="botoes" role="toolbar" aria-label="Ferramentas de formatação">
        <button class="botao" id="btn-negrito" title="Negrito (Ctrl+B)"><strong>N</strong></button>
        <button class="botao" id="btn-riscado" title="Riscado (Ctrl+S)"><s>S</s></button>
        <button class="botao" id="btn-sublinhado" title="Sublinhado (Ctrl+U)"><u>U</u></button>
        <button class="botao" id="btn-lista" title="Lista não ordenada (Ctrl+L)">📋</button>
      </div>
    </header>

    <div class="abas-container">
      <div class="scroll-indicator left">◀</div>
      <div class="abas" id="abas">
        <button class="aba ativa" data-id="1" contenteditable="true">Bloco 1</button>
        <button class="aba" data-id="2" contenteditable="true">Bloco 2</button>
        <button class="aba" data-id="3" contenteditable="true">Bloco 3</button>
        <button class="aba" data-id="4" contenteditable="true">Bloco 4</button>
        <button class="aba" data-id="5" contenteditable="true">Bloco 5</button>
        <button class="aba" data-id="6" contenteditable="true">Bloco 6</button>
        <button class="aba" data-id="7" contenteditable="true">Bloco 7</button>
        <button class="aba" data-id="8" contenteditable="true">Bloco 8</button>
      </div>
      <div class="scroll-indicator right">▶</div>
    </div>

    <div class="area" id="area">
      <aside class="barra-lateral">
        <div class="info">
          <p><strong>Atalhos</strong></p>
          <p>Ctrl/Cmd + B → Negrito</p>
          <p>Ctrl/Cmd + S → Riscado</p>
          <p>Ctrl/Cmd + U → Sublinhado</p>
          <p>Ctrl/Cmd + L → Lista</p>
        </div>
      </aside>

      <main class="editor">
        <div id="conteudo" class="conteudo vazio" contenteditable="true" spellcheck="true" aria-label="Área de edição">Comece a escrever aqui...</div>
        <div class="rodape" id="rodape">
          <div id="status">Salvando...</div>
          <div>
            <button class="btn-acao" id="btn-limpar">Limpar</button>
          </div>
        </div>
        <div class="copyright">
          <a href="https://bmfolio.web.app/" title="" target="_blank" rel="noopener noreferrer">
			<span>© <span id="ano-atual">2025</span> Bruno Moraes</span>
		  </a>
          <a href="licenca-agplv3.html" title="Visualizar licença AGPLv3" target="_blank" rel="noopener noreferrer">AGPL-3.0 license</a>
          <a href="#" title="Saiba como suas informações são armazenadas" class="comoArmazena">Como as informações são armazenadas?</a>
        </div>
      </main>
    </div>
  </div>

  <script>
    const CHAVE_STORAGE = 'bloco_de_notas_abas';
    const areaNotas = document.getElementById('conteudo');
    const btnNegrito = document.getElementById('btn-negrito');
    const btnSublinhado = document.getElementById('btn-sublinhado');
    const btnRiscado = document.getElementById('btn-riscado');
    const btnLista = document.getElementById('btn-lista');
    const statusSalvamento = document.getElementById('status');
    const btnLimpar = document.getElementById('btn-limpar');
    const abas = document.getElementById('abas');
    const header = document.getElementById('header');
    const area = document.getElementById('area');
    const rodape = document.getElementById('rodape');
    let temporizadorSalvamento = null;
    let abaAtual = "1";

    const cores = {
      "1":"#f2f2f2",
      "2":"#ffd6d6",
      "3":"#ffe5b4",
      "4":"#fffacd",
      "5":"#d9fdd3",
      "6":"#d6eaff",
      "7":"#dcd6ff",
      "8":"#f0d6ff"
    };

    // Carrega e garante que existam as 8 chaves (evita erro quando localStorage tem versão antiga)
    function carregarDados() {
      let salvo = localStorage.getItem(CHAVE_STORAGE);
      let dados = salvo ? JSON.parse(salvo) : {};
      // garante 1..8
      for (let i = 1; i <= 8; i++) {
        let chave = String(i);
        if (!dados[chave]) {
          dados[chave] = { titulo: "Bloco " + chave, conteudo: "", data: "" };
        } else {
          // garantir título padrão caso falte
          if (!dados[chave].titulo) dados[chave].titulo = "Bloco " + chave;
          if (typeof dados[chave].conteudo === 'undefined') dados[chave].conteudo = "";
          if (!dados[chave].data) dados[chave].data = "";
        }
      }
      // salva a versão "completa" de volta (opcional, evita re-erro)
      localStorage.setItem(CHAVE_STORAGE, JSON.stringify(dados));
      return dados;
    }

    function salvarDados(dados) {
      localStorage.setItem(CHAVE_STORAGE, JSON.stringify(dados));
    }

    function formatarDataHora() {
      const agora = new Date();
      return agora.toLocaleString("pt-BR");
    }

    // aplica os títulos das abas a partir do localStorage (sincroniza visual)
    function aplicarTitulos(dados) {
      document.querySelectorAll(".aba").forEach(function(aba){
        const id = aba.dataset.id;
        if (dados[id] && dados[id].titulo) {
          aba.textContent = dados[id].titulo;
        }
      });
    }

    function restaurarAba(id) {
      const dados = carregarDados();
      abaAtual = id;
      // sincroniza títulos (caso o usuário tenha alterado antes)
      aplicarTitulos(dados);

      const conteudo = dados[id].conteudo || "";
      if (conteudo.trim() === "") {
        areaNotas.textContent = "Comece a escrever aqui...";
        areaNotas.classList.add("vazio");
      } else {
        areaNotas.innerHTML = conteudo;
        areaNotas.classList.remove("vazio");
      }

      statusSalvamento.textContent = dados[id].data ? 'Última modificação: ' + dados[id].data : 'Nenhum conteúdo salvo ainda.';

      document.querySelectorAll(".aba").forEach(function(btn){ btn.classList.remove("ativa"); });
      const botaoAtivo = document.querySelector(`.aba[data-id="${id}"]`);
      if (botaoAtivo) botaoAtivo.classList.add("ativa");

      // aplica cor nos elementos solicitados (header, área e rodapé) - campo de texto permanece branco
      const cor = cores[id] || "#ffffff";
      header.style.background = cor;
      area.style.background = cor;
      rodape.style.background = cor;
    }

    function salvarParaLocalStorage() {
      if (temporizadorSalvamento) clearTimeout(temporizadorSalvamento);
      temporizadorSalvamento = setTimeout(function() {
        try {
          const dados = carregarDados();
          // garante entrada existente (caso tenha sido removida por alguma versão anterior)
          if (!dados[abaAtual]) dados[abaAtual] = { titulo: "Bloco " + abaAtual, conteudo: "", data: "" };
          let texto = areaNotas.classList.contains("vazio") ? "" : areaNotas.innerHTML;
          dados[abaAtual].conteudo = texto;
          dados[abaAtual].data = formatarDataHora();
          salvarDados(dados);
          statusSalvamento.textContent = 'Última modificação: ' + dados[abaAtual].data;
        } catch (erro) {
          statusSalvamento.textContent = 'Erro ao salvar: ' + (erro && erro.message ? erro.message : String(erro));
        }
      }, 500);
    }

    function aplicarComando(comando) {
      document.execCommand(comando, false, null);
      areaNotas.focus();
      salvarParaLocalStorage();
    }

    // Eventos formatação (mantive seus botões e atalhos)
    btnNegrito.addEventListener('click', function() { aplicarComando('bold'); });
    btnSublinhado.addEventListener('click', function() { aplicarComando('underline'); });
    btnRiscado.addEventListener('click', function() { aplicarComando('strikeThrough'); });
    btnLista.addEventListener('click', function() { aplicarComando('insertUnorderedList'); });

    // Placeholder: ao focar, limpa; porém só volta ao usar "Limpar" (conforme pediu)
    areaNotas.addEventListener("focus", function(){
      if (areaNotas.classList.contains("vazio")){
        areaNotas.textContent = "";
        areaNotas.classList.remove("vazio");
      }
    });
    // removi o blur que reintroduzia o placeholder automaticamente

    // Colar sem formatação
    areaNotas.addEventListener("paste", function(e){
      e.preventDefault();
      const texto = (e.clipboardData || window.clipboardData).getData("text");
      document.execCommand("insertText", false, texto);
    });

    // Limpar (apaga conteúdo desta aba e reaplica placeholder)
    btnLimpar.addEventListener('click', function() {
      if (confirm('Limpar todo o conteúdo salvo desta aba?')) {
        const dados = carregarDados();
        if (!dados[abaAtual]) dados[abaAtual] = { titulo: "Bloco " + abaAtual, conteudo: "", data: "" };
        dados[abaAtual].conteudo = "";
        dados[abaAtual].data = "";
        salvarDados(dados);
        // re-renderiza apenas a aba atual
        areaNotas.textContent = "Comece a escrever aqui...";
        areaNotas.classList.add("vazio");
        statusSalvamento.textContent = 'Conteúdo limpo.';
      }
    });

    areaNotas.addEventListener('input', salvarParaLocalStorage);

    // Atalhos de teclado
    document.addEventListener('keydown', function(e) {
      if ((e.ctrlKey || e.metaKey) && areaNotas.contains(document.activeElement)) {
        const tecla = e.key.toLowerCase();
        switch(tecla){
          case 'b': e.preventDefault(); aplicarComando('bold'); break;
          case 'u': e.preventDefault(); aplicarComando('underline'); break;
          case 's': e.preventDefault(); aplicarComando('strikeThrough'); break;
          case 'l': e.preventDefault(); aplicarComando('insertUnorderedList'); break;
        }
      }
    });

    // Troca de aba (clique)
    abas.addEventListener("click", function(e){
      const alvo = e.target;
      if (alvo && alvo.classList && alvo.classList.contains("aba")) {
        // salva conteúdo antes de trocar
        salvarParaLocalStorage();
        restaurarAba(alvo.dataset.id);
      }
    });

    // Editar título da aba -> salva título no localStorage
    document.querySelectorAll(".aba").forEach(function(aba){
      aba.addEventListener("input", function(){
        const dados = carregarDados();
        const id = this.dataset.id;
        if (!dados[id]) dados[id] = { titulo: "Bloco " + id, conteudo: "", data: "" };
        dados[id].titulo = this.textContent.trim() || ("Bloco " + id);
        salvarDados(dados);
      });
      
      // Selecionar todo o texto ao focar na aba para edição
      aba.addEventListener("click", function(e) {
        if (this.isContentEditable) {
          // Pequeno delay para garantir que o foco foi estabelecido
          setTimeout(() => {
            const selecao = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(this);
            selecao.removeAllRanges();
            selecao.addRange(range);
          }, 0);
        }
      });
    });

    // Inicializar: carregar dados, aplicar títulos e restaurar aba 1 (ou última usada no futuro)
    (function inicializar(){
      const dados = carregarDados();
      aplicarTitulos(dados);
      restaurarAba("1");
      
      // Definir ano atual no copyright
      document.getElementById('ano-atual').textContent = new Date().getFullYear();
    })();

    // Atualizar indicadores de scroll
    function atualizarIndicadoresScroll() {
      const container = document.querySelector('.abas');
      const leftIndicator = document.querySelector('.scroll-indicator.left');
      const rightIndicator = document.querySelector('.scroll-indicator.right');
      
      // Mostrar/ocultar indicadores conforme a posição do scroll
      if (container.scrollLeft > 0) {
        leftIndicator.style.opacity = '1';
        leftIndicator.style.pointerEvents = 'auto';
      } else {
        leftIndicator.style.opacity = '0';
        leftIndicator.style.pointerEvents = 'none';
      }
      
      if (container.scrollLeft < container.scrollWidth - container.clientWidth) {
        rightIndicator.style.opacity = '1';
        rightIndicator.style.pointerEvents = 'auto';
      } else {
        rightIndicator.style.opacity = '0';
        rightIndicator.style.pointerEvents = 'none';
      }
    }

    // Adicionar event listeners para os indicadores de scroll
    document.querySelector('.scroll-indicator.left').addEventListener('click', function() {
      document.querySelector('.abas').scrollBy({ left: -100, behavior: 'smooth' });
    });
    
    document.querySelector('.scroll-indicator.right').addEventListener('click', function() {
      document.querySelector('.abas').scrollBy({ left: 100, behavior: 'smooth' });
    });
    
    // Atualizar indicadores quando houver scroll
    document.querySelector('.abas').addEventListener('scroll', atualizarIndicadoresScroll);
    
    // Atualizar indicadores quando a janela for redimensionada
    window.addEventListener('resize', atualizarIndicadoresScroll);
    
    // Inicializar indicadores
    setTimeout(atualizarIndicadoresScroll, 100);
  </script>
</body>
</html>